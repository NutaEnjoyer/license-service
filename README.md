# License Service API

–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ª–∏—Ü–µ–Ω–∑–∏—è–º–∏ —Å REST API. –ü–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å, –ø—Ä–æ–≤–µ—Ä—è—Ç—å, –∏–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –∏ –ø—Ä–æ–¥–ª–µ–≤–∞—Ç—å –ª–∏—Ü–µ–Ω–∑–∏–∏ –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](#–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç)
- [–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫](#—É—Å—Ç–∞–Ω–æ–≤–∫–∞-–∏-–∑–∞–ø—É—Å–∫)
- [API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](#api-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)
  - [–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è](#–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è)
  - [–ú–µ—Ç–æ–¥—ã API](#–º–µ—Ç–æ–¥—ã-api)
- [–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è](#–ø—Ä–∏–º–µ—Ä—ã-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)
- [–ö–æ–¥—ã –æ—à–∏–±–æ–∫](#–∫–æ–¥—ã-–æ—à–∏–±–æ–∫)

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker

1. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env`:
```env
JWT_SECRET=your-secret-key-change-this-in-production
```

2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:
```bash
docker-compose up -d --build
```

3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å:
```bash
curl http://localhost:8080/
```

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É: `http://localhost:8080`

---

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Docker –∏ Docker Compose
- Go 1.25+ (–µ—Å–ª–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç–µ –±–µ–∑ Docker)

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```env
JWT_SECRET=–≤–∞—à-—Å–ª—É—á–∞–π–Ω—ã–π-—Å–µ–∫—Ä–µ—Ç-–º–∏–Ω–∏–º—É–º-32-—Å–∏–º–≤–æ–ª–∞
```

**–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–µ–∫—Ä–µ—Ç–∞:**
```bash
openssl rand -hex 32
```

### –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker

```bash
# –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫
docker-compose up -d --build

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs -f

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
docker-compose down
```

### –ó–∞–ø—É—Å–∫ –±–µ–∑ Docker

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
go mod download

# –ó–∞–ø—É—Å–∫
go run cmd/license-service/main.go
```

---

## üìö API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –ë–∞–∑–æ–≤—ã–π URL

```
http://localhost:8080
```

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

–ù–µ–∫–æ—Ç–æ—Ä—ã–µ endpoints —Ç—Ä–µ–±—É—é—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ JWT —Ç–æ–∫–µ–Ω.

**–§–æ—Ä–º–∞—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∞:**
```
Authorization: Bearer <access_token>
```

**–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞:**
- –ü–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (`/register`) –∏–ª–∏ –≤—Ö–æ–¥–∞ (`/login`) –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è `access_token`
- –¢–æ–∫–µ–Ω –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω 15 –º–∏–Ω—É—Ç

---

## üîå –ú–µ—Ç–æ–¥—ã API

### 1. Health Check

–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–∞.

**Endpoint:** `GET /`

**–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:** –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è

**–ó–∞–ø—Ä–æ—Å:**
```bash
curl http://localhost:8080/
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "health": true
}
```

**–ö–æ–¥—ã –æ—Ç–≤–µ—Ç–∞:**
- `200 OK` - –°–µ—Ä–≤–∏—Å —Ä–∞–±–æ—Ç–∞–µ—Ç

---

### 2. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Å–∏—Å—Ç–µ–º–µ.

**Endpoint:** `POST /register`

**–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:** –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è

**–ó–∞–ø—Ä–æ—Å:**
```bash
curl -X POST http://localhost:8080/register \
  -H "Content-Type: application/json" \
  -d '{
    "login": "admin",
    "password": "password123"
  }'
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "login": "string",      // –ú–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤
  "password": "string"    // –ú–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤
}
```

**–û—Ç–≤–µ—Ç (—É—Å–ø–µ—Ö):**
```json
{
  "ok": true,
  "message": "User successfully created",
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

**–ö–æ–¥—ã –æ—Ç–≤–µ—Ç–∞:**
- `201 Created` - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω
- `400 Bad Request` - –ù–µ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–µ, –ª–æ–≥–∏–Ω —É–∂–µ –∑–∞–Ω—è—Ç)
- `405 Method Not Allowed` - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –Ω–µ–≤–µ—Ä–Ω—ã–π HTTP –º–µ—Ç–æ–¥

**–û—à–∏–±–∫–∏:**
```json
// –õ–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–µ
{
  "error": "Login and/or Password invalid"
}

// –õ–æ–≥–∏–Ω —É–∂–µ –∑–∞–Ω—è—Ç
{
  "error": "Login is already taken"
}
```

---

### 3. –í—Ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**Endpoint:** `POST /login`

**–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:** –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è

**–ó–∞–ø—Ä–æ—Å:**
```bash
curl -X POST http://localhost:8080/login \
  -H "Content-Type: application/json" \
  -d '{
    "login": "admin",
    "password": "password123"
  }'
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "login": "string",
  "password": "string"
}
```

**–û—Ç–≤–µ—Ç (—É—Å–ø–µ—Ö):**
```json
{
  "ok": true,
  "message": "User successfully logined",
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

**–ö–æ–¥—ã –æ—Ç–≤–µ—Ç–∞:**
- `200 OK` - –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥
- `400 Bad Request` - –ù–µ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- `401 Unauthorized` - –ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å
- `405 Method Not Allowed` - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –Ω–µ–≤–µ—Ä–Ω—ã–π HTTP –º–µ—Ç–æ–¥

**–û—à–∏–±–∫–∏:**
```json
// –ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å
{
  "error": "Failed to login. Incorrect login or password"
}
```

---

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏—Ü–µ–Ω–∑–∏–∏

–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ª–∏—Ü–µ–Ω–∑–∏–æ–Ω–Ω–æ–≥–æ –∫–ª—é—á–∞.

**Endpoint:** `GET /check?key=<license_key>`

**–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:** –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è

**–ó–∞–ø—Ä–æ—Å:**
```bash
curl "http://localhost:8080/check?key=ABC123XYZ"
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞:**
- `key` (query parameter, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π) - –õ–∏—Ü–µ–Ω–∑–∏–æ–Ω–Ω—ã–π –∫–ª—é—á

**–û—Ç–≤–µ—Ç (—É—Å–ø–µ—Ö):**
```json
{
  "valid": true,
  "expire_time": "2024-12-31T23:59:59Z",
  "message": "License is valid"
}
```

**–û—Ç–≤–µ—Ç (–ª–∏—Ü–µ–Ω–∑–∏—è –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞):**
```json
{
  "valid": false,
  "expire_time": "0001-01-01T00:00:00Z",
  "message": "Invalid license key"
}
```

**–û—Ç–≤–µ—Ç (–ª–∏—Ü–µ–Ω–∑–∏—è –∏—Å—Ç–µ–∫–ª–∞):**
```json
{
  "valid": false,
  "expire_time": "2024-01-01T00:00:00Z",
  "message": "License expired"
}
```

**–ö–æ–¥—ã –æ—Ç–≤–µ—Ç–∞:**
- `200 OK` - –ó–∞–ø—Ä–æ—Å –æ–±—Ä–∞–±–æ—Ç–∞–Ω
- `400 Bad Request` - –ù–µ —É–∫–∞–∑–∞–Ω –∫–ª—é—á
- `405 Method Not Allowed` - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –Ω–µ–≤–µ—Ä–Ω—ã–π HTTP –º–µ—Ç–æ–¥

---

### 5. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ª–∏—Ü–µ–Ω–∑–∏–∏

–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –ª–∏—Ü–µ–Ω–∑–∏–∏.

**Endpoint:** `POST /add?key=<optional_key>`

**–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:** –¢—Ä–µ–±—É–µ—Ç—Å—è (Bearer token)

**–ó–∞–ø—Ä–æ—Å:**
```bash
curl -X POST "http://localhost:8080/add" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN" \
  -d '{
    "owner": "admin",
    "product": "MyProduct",
    "one_time": false,
    "expire_time": 1440
  }'
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞:**
- `key` (query parameter, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π) - –ú–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "owner": "string",        // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è, –±–µ—Ä–µ—Ç—Å—è –∏–∑ —Ç–æ–∫–µ–Ω–∞
  "product": "string",      // –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞
  "one_time": boolean,      // –û–¥–Ω–æ—Ä–∞–∑–æ–≤–∞—è –ª–∏—Ü–µ–Ω–∑–∏—è (true/false)
  "expire_time": number     // –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ –≤ –º–∏–Ω—É—Ç–∞—Ö (–º–∏–Ω–∏–º—É–º 5)
}
```

**–û—Ç–≤–µ—Ç (—É—Å–ø–µ—Ö):**
```json
{
  "message": "License added successfully",
  "key": "ABC123XYZ456DEF789"
}
```

**–ö–æ–¥—ã –æ—Ç–≤–µ—Ç–∞:**
- `201 Created` - –õ–∏—Ü–µ–Ω–∑–∏—è —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞
- `400 Bad Request` - –ù–µ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–≤—Ä–µ–º—è –º–µ–Ω–µ–µ 5 –º–∏–Ω—É—Ç)
- `401 Unauthorized` - –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –∏–ª–∏ –Ω–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω
- `405 Method Not Allowed` - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –Ω–µ–≤–µ—Ä–Ω—ã–π HTTP –º–µ—Ç–æ–¥
- `500 Internal Server Error` - –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

**–û—à–∏–±–∫–∏:**
```json
// –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ –º–µ–Ω–µ–µ 5 –º–∏–Ω—É—Ç
{
  "error": "Expire time must be more than 5 minutes"
}
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:**
- –ü–æ–ª–µ `owner` –≤ –∑–∞–ø—Ä–æ—Å–µ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–æ–≥–∏–Ω –∏–∑ JWT —Ç–æ–∫–µ–Ω–∞
- –õ–∏—Ü–µ–Ω–∑–∏–æ–Ω–Ω—ã–π –∫–ª—é—á –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- `expire_time` —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤ –º–∏–Ω—É—Ç–∞—Ö –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ –º–æ–º–µ–Ω—Ç–∞

---

### 6. –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –ª–∏—Ü–µ–Ω–∑–∏–∏

–î–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è –ª–∏—Ü–µ–Ω–∑–∏–∏ (—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è –Ω–∞ —Ç–µ–∫—É—â–∏–π –º–æ–º–µ–Ω—Ç).

**Endpoint:** `POST /invalid?key=<license_key>`

**–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:** –¢—Ä–µ–±—É–µ—Ç—Å—è (Bearer token)

**–ó–∞–ø—Ä–æ—Å:**
```bash
curl -X POST "http://localhost:8080/invalid?key=ABC123XYZ" \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN"
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞:**
- `key` (query parameter, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π) - –õ–∏—Ü–µ–Ω–∑–∏–æ–Ω–Ω—ã–π –∫–ª—é—á –¥–ª—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏

**–û—Ç–≤–µ—Ç (—É—Å–ø–µ—Ö):**
```json
{
  "message": "License invalided successfully",
  "key": "ABC123XYZ"
}
```

**–ö–æ–¥—ã –æ—Ç–≤–µ—Ç–∞:**
- `200 OK` - –õ–∏—Ü–µ–Ω–∑–∏—è —É—Å–ø–µ—à–Ω–æ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–∞
- `400 Bad Request` - –ù–µ —É–∫–∞–∑–∞–Ω –∫–ª—é—á
- `401 Unauthorized` - –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –∏–ª–∏ –Ω–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω
- `405 Method Not Allowed` - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –Ω–µ–≤–µ—Ä–Ω—ã–π HTTP –º–µ—Ç–æ–¥
- `500 Internal Server Error` - –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

**–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:**
- –ú–æ–∂–Ω–æ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –ª–∏—Ü–µ–Ω–∑–∏–∏ (—Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ç–µ–º –∂–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º)
- –ü–æ—Å–ª–µ –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ª–∏—Ü–µ–Ω–∑–∏—è —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–π

---

### 7. –ü—Ä–æ–¥–ª–µ–Ω–∏–µ –ª–∏—Ü–µ–Ω–∑–∏–∏

–£–≤–µ–ª–∏—á–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –¥–µ–π—Å—Ç–≤–∏—è –ª–∏—Ü–µ–Ω–∑–∏–∏.

**Endpoint:** `POST /extend?key=<license_key>`

**–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:** –¢—Ä–µ–±—É–µ—Ç—Å—è (Bearer token)

**–ó–∞–ø—Ä–æ—Å:**
```bash
curl -X POST "http://localhost:8080/extend?key=ABC123XYZ" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN" \
  -d '{
    "additional_time": 1440
  }'
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞:**
- `key` (query parameter, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π) - –õ–∏—Ü–µ–Ω–∑–∏–æ–Ω–Ω—ã–π –∫–ª—é—á –¥–ª—è –ø—Ä–æ–¥–ª–µ–Ω–∏—è

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "additional_time": number  // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –≤ –º–∏–Ω—É—Ç–∞—Ö (–º–∏–Ω–∏–º—É–º 5)
}
```

**–û—Ç–≤–µ—Ç (—É—Å–ø–µ—Ö):**
```json
{
  "message": "License extended successfully",
  "key": "ABC123XYZ"
}
```

**–ö–æ–¥—ã –æ—Ç–≤–µ—Ç–∞:**
- `200 OK` - –õ–∏—Ü–µ–Ω–∑–∏—è —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–¥–ª–µ–Ω–∞
- `400 Bad Request` - –ù–µ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–≤—Ä–µ–º—è –º–µ–Ω–µ–µ 5 –º–∏–Ω—É—Ç, –Ω–µ —É–∫–∞–∑–∞–Ω –∫–ª—é—á)
- `401 Unauthorized` - –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –∏–ª–∏ –Ω–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω
- `403 Forbidden` - –õ–∏—Ü–µ–Ω–∑–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –∏–ª–∏ –Ω–µ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- `405 Method Not Allowed` - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –Ω–µ–≤–µ—Ä–Ω—ã–π HTTP –º–µ—Ç–æ–¥
- `500 Internal Server Error` - –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

**–û—à–∏–±–∫–∏:**
```json
// –í—Ä–µ–º—è –º–µ–Ω–µ–µ 5 –º–∏–Ω—É—Ç
{
  "error": "Additional time must be more than 5 minutes"
}

// –õ–∏—Ü–µ–Ω–∑–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –∏–ª–∏ –Ω–µ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
{
  "error": "License not found or access denied"
}
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:**
- –ú–æ–∂–Ω–æ –ø—Ä–æ–¥–ª–µ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –ª–∏—Ü–µ–Ω–∑–∏–∏
- –ï—Å–ª–∏ –ª–∏—Ü–µ–Ω–∑–∏—è —É–∂–µ –∏—Å—Ç–µ–∫–ª–∞, –≤—Ä–µ–º—è –ø—Ä–æ–¥–ª–µ–Ω–∏—è —Å—á–∏—Ç–∞–µ—Ç—Å—è –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ –º–æ–º–µ–Ω—Ç–∞
- –ï—Å–ª–∏ –ª–∏—Ü–µ–Ω–∑–∏—è –µ—â–µ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞, –≤—Ä–µ–º—è –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∫ —Ç–µ–∫—É—â–µ–º—É —Å—Ä–æ–∫—É –∏—Å—Ç–µ—á–µ–Ω–∏—è

---

## üí° –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Ä–∞–±–æ—Ç—ã —Å –ª–∏—Ü–µ–Ω–∑–∏—è–º–∏

```bash
# 1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
REGISTER_RESPONSE=$(curl -s -X POST http://localhost:8080/register \
  -H "Content-Type: application/json" \
  -d '{
    "login": "admin",
    "password": "password123"
  }')

# –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
TOKEN=$(echo $REGISTER_RESPONSE | jq -r '.access_token')

# 2. –°–æ–∑–¥–∞–Ω–∏–µ –ª–∏—Ü–µ–Ω–∑–∏–∏ (–Ω–∞ 24 —á–∞—Å–∞ = 1440 –º–∏–Ω—É—Ç)
LICENSE_RESPONSE=$(curl -s -X POST "http://localhost:8080/add" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $TOKEN" \
  -d '{
    "product": "MyProduct",
    "one_time": false,
    "expire_time": 1440
  }')

# –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–ª—é—á–∞ –ª–∏—Ü–µ–Ω–∑–∏–∏
LICENSE_KEY=$(echo $LICENSE_RESPONSE | jq -r '.key')
echo "License key: $LICENSE_KEY"

# 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏—Ü–µ–Ω–∑–∏–∏
curl -s "http://localhost:8080/check?key=$LICENSE_KEY" | jq

# 4. –ü—Ä–æ–¥–ª–µ–Ω–∏–µ –ª–∏—Ü–µ–Ω–∑–∏–∏ (–Ω–∞ –µ—â–µ 24 —á–∞—Å–∞)
curl -s -X POST "http://localhost:8080/extend?key=$LICENSE_KEY" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $TOKEN" \
  -d '{
    "additional_time": 1440
  }' | jq

# 5. –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –ª–∏—Ü–µ–Ω–∑–∏–∏
curl -s -X POST "http://localhost:8080/invalid?key=$LICENSE_KEY" \
  -H "Authorization: Bearer $TOKEN" | jq
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å Python

```python
import requests
import json

BASE_URL = "http://localhost:8080"

# –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
response = requests.post(f"{BASE_URL}/register", json={
    "login": "admin",
    "password": "password123"
})
token = response.json()["access_token"]

# –°–æ–∑–¥–∞–Ω–∏–µ –ª–∏—Ü–µ–Ω–∑–∏–∏
headers = {"Authorization": f"Bearer {token}"}
response = requests.post(
    f"{BASE_URL}/add",
    headers=headers,
    json={
        "product": "MyProduct",
        "one_time": False,
        "expire_time": 1440  # 24 —á–∞—Å–∞
    }
)
license_key = response.json()["key"]
print(f"License key: {license_key}")

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏—Ü–µ–Ω–∑–∏–∏
response = requests.get(f"{BASE_URL}/check", params={"key": license_key})
print(json.dumps(response.json(), indent=2))
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å JavaScript/Node.js

```javascript
const axios = require('axios');

const BASE_URL = 'http://localhost:8080';

async function main() {
  // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
  const registerResponse = await axios.post(`${BASE_URL}/register`, {
    login: 'admin',
    password: 'password123'
  });
  const token = registerResponse.data.access_token;

  // –°–æ–∑–¥–∞–Ω–∏–µ –ª–∏—Ü–µ–Ω–∑–∏–∏
  const headers = { Authorization: `Bearer ${token}` };
  const addResponse = await axios.post(
    `${BASE_URL}/add`,
    {
      product: 'MyProduct',
      one_time: false,
      expire_time: 1440 // 24 —á–∞—Å–∞
    },
    { headers }
  );
  const licenseKey = addResponse.data.key;
  console.log(`License key: ${licenseKey}`);

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏—Ü–µ–Ω–∑–∏–∏
  const checkResponse = await axios.get(`${BASE_URL}/check`, {
    params: { key: licenseKey }
  });
  console.log(checkResponse.data);
}

main();
```

---

## ‚ö†Ô∏è –ö–æ–¥—ã –æ—à–∏–±–æ–∫

| –ö–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----|----------|
| `200 OK` | –£—Å–ø–µ—à–Ω—ã–π –∑–∞–ø—Ä–æ—Å |
| `201 Created` | –†–µ—Å—É—Ä—Å —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω |
| `400 Bad Request` | –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞ –∏–ª–∏ –¥–∞–Ω–Ω—ã–µ |
| `401 Unauthorized` | –¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏–ª–∏ –Ω–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω |
| `403 Forbidden` | –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω (–ª–∏—Ü–µ–Ω–∑–∏—è –Ω–µ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é) |
| `405 Method Not Allowed` | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –Ω–µ–≤–µ—Ä–Ω—ã–π HTTP –º–µ—Ç–æ–¥ |
| `500 Internal Server Error` | –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ |

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ü–∞—Ä–æ–ª–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ (bcrypt)
- JWT —Ç–æ–∫–µ–Ω—ã –∏–º–µ—é—Ç —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è (15 –º–∏–Ω—É—Ç)
- –õ–∏—Ü–µ–Ω–∑–∏–∏ –º–æ–≥—É—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –∏—Ö —Å–æ–∑–¥–∞—Ç–µ–ª—è–º–∏
- –í—Å–µ –∑–∞—â–∏—â–µ–Ω–Ω—ã–µ endpoints —Ç—Ä–µ–±—É—é—Ç –≤–∞–ª–∏–¥–Ω—ã–π JWT —Ç–æ–∫–µ–Ω

---

## üìù –ó–∞–º–µ—Ç–∫–∏

- –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ –ª–∏—Ü–µ–Ω–∑–∏–∏ —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤ –º–∏–Ω—É—Ç–∞—Ö
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ –ª–∏—Ü–µ–Ω–∑–∏–∏: 5 –º–∏–Ω—É—Ç
- –õ–∏—Ü–µ–Ω–∑–∏–æ–Ω–Ω—ã–µ –∫–ª—é—á–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö SQLite —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `./storage/storage.db`
- –ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ Docker, –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ volume

---

## üõ†Ô∏è –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

```bash
go run cmd/license-service/main.go
```

### –°–±–æ—Ä–∫–∞

```bash
go build -o license-service ./cmd/license-service
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
go test ./...
```

---

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License

